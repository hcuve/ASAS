---
title: "Figures"
author: "Helio"
date: "04/09/2021"
output: html_document
---

interaction plot

https://uc-r.github.io/kmeans_clustering

```{r}
sf = 1 # scaling factor to make it easier to change sizes of everything, in which case change here

p$graphstyle_int <-  theme(#base plot theme
  
  # axis lines
  axis.line.y = element_line(color="black", size = 1.5),
  axis.line.x = element_line(color="black", size = 1,5),
  
  axis.title.y=element_text(size = 16*(sf+.5), margin=margin(0,5,0,0)),
  axis.title.x=element_text(size = 16*(sf+.5), margin=margin(0,5,0,0)),
  
  # text
  strip.text.x = element_text(size = 12*(sf+.5),  colour = "black"),
  strip.text.y = element_text(size = 12*(sf+.5),  colour = "black"),
  
  text=element_text(size = 14, family = "sans"),
  axis.text.x = element_text(size = 14*(sf+.5), family = "sans", colour = "black",),
  axis.text.y = element_text(size = 14*(sf+.5), family = "sans", colour = "black"),
  
  
  # panel
  panel.grid.major = element_blank(),
  panel.background = element_blank(),
  # panel.background = element_rect(fill="transparent"),
  # panel.border = element_rect(fill="transparent"),
  # strip shades (reco rectagles)
   # strip.background = element_blank(),
  
  # legend
  legend.position = "top",
  legend.key = element_rect(colour = "transparent", fill="transparent"),
  #legend.direction = "horizontal",

  legend.text = element_text(size = 10*(sf+.3)),
  # legend.title = element_text(size = 10*(sf+.3)),
  # legend line tends to be really small in print so adjust here
  legend.key.height = unit(.5, "cm"),
  legend.key.width = unit(2, "cm"),
  
  #legend.text = element_text(size = 10*sf),
  # legend.title=element_blank(),
  #legend.text = element_blank(),
  #axis.ticks = element_blank(),
)

```


Pupil
- arousalx valence effect

```{r}

plots_paper$interaction_ar_vl <- interactions::interact_plot(pupil_arousal_findings$pupil_from_ar_vale , pred = arousal_c, modx = valence_c,
                            line.thickness = 2)

# ?interactions::interact_plot()
plots_paper$interaction_ar_vl<- plots_paper$interaction_ar_vl +
  theme_classic()+
  p$graphstyle_int+
  xlab("Subjective arousal (z)")+
  ylab("Pupil change (z)")+
  scale_y_continuous(breaks = c(-1,0,1))


library(interactions)

plots_paper$interaction_ar_vl<- plots_paper$interaction_ar_vl +   scale_y_continuous(breaks = c(-1.5,-1,-.5,0,.5), limits = c(-2,.5))


plots_paper$interaction_ar_vl <- plots_paper$interaction_ar_vl +
   theme_classic()+
   p$graphstyle_int
   # change leged title
   guides(linetype=guide_legend(title="New Legend Title"), fill = guide_legend(title="New Legend Title"))
   
plots_paper$interaction_ar_vl 

# plots_paper[["interaction_ar_vl"]][["data"]]%>%
#   ggplot(aes(arousal_c, pup_basCor, linetype = modx_group))+
#   stat_summary(aes(fill = modx_group), geom = 'line', size = 2)+
#   p$graphstyle_int



```

Illustration to show that pupil tracks arousal better for more positive emotions
- check how this looks with clusters


```{r}

symnum.args <- list(cutpoints = c(0, 0.0001, 0.001, 0.01, 0.05, 1), symbols = c("****", "***", "**", "*", "ns"))

db_full4new_stim_screen_pupil_nopract
plots_paper$pupil_correlation <- db_full4new_stim_screen_pupil_nopract %>%
  subset(!is.na(mediansplit_sample_valence2))%>%
   subset(Group == "NT")%>%
  # subset(pupil_outlier == FALSE)%>%
  # subset( arousal_outler == FALSE & !is.na(Alexithymia))%>%
  # subset(!is.na(Alexithymia))%>%
  # subset(ssid_num<500)%>%
    # group_by(ssid,Alexithymia, is_valence_high)%>%
   group_by(ssid, mediansplit_sample_valence2)%>%
    mutate(cortest = cor(arousal_c, pup_basCor, use = "complete"))%>%
    summarise_if(is.numeric, mean, na.rm = TRUE)%>%
        ggplot(aes(mediansplit_sample_valence2, cortest, fill = mediansplit_sample_valence2, 
                   color = mediansplit_sample_valence2))+
           geom_bar(aes(linetype = mediansplit_sample_valence2), 
                    stat="summary", fun.y = "mean", alpha = .3, width = .5, size = 2)+
    geom_jitter(width = .1, alpha = .1)+
        stat_summary( geom = 'pointrange', color = "black")+
          stat_summary(aes(group = ssid), geom = 'line', color = "black", alpha = .3)+
    ylab("R pupil vs self report arousal")+
  theme_classic()+
  geom_hline(yintercept = 0, linetype = 'dashed', alpha = .2)+
   # ggpubr::stat_compare_means(paired = TRUE)+
  ggpubr::stat_compare_means(method = 't.test',
                             symnum.args = symnum.args)+
   ylab(expression("Pupil vs subjective arousal ("*rho * ")"))+
   xlab("Subjective valence")
   
 plots_paper$pupil_correlation<- plots_paper$pupil_correlation+ p$graphstyle+
    scale_fill_brewer(palette = "Dark2")+
     scale_color_brewer(palette = "Dark2")

plots_paper$pupil_correlation

# try with cluster]

db_full4new_stim_screen_pupil_nopract$stimIAPS2<- substring(db_full4new_stim_screen_pupil_nopract$stimIAPS,1,4)
left_join(db_full4new_stim_screen_pupil_nopract, cluster_stim)%>%
  subset(!is.na(mediansplit_sample_valence2))%>%
   subset(Group == "NT")%>%
  # subset(pupil_outlier == FALSE)%>%
  # subset( arousal_outler == FALSE & !is.na(Alexithymia))%>%
  # subset(!is.na(Alexithymia))%>%
  # subset(ssid_num<500)%>%
    # group_by(ssid,Alexithymia, is_valence_high)%>%
   group_by(ssid, cluster_interpreted)%>%
    mutate(cortest = cor(arousal_c, pup_basCor, use = "complete"))%>%
    summarise_if(is.numeric, mean, na.rm = TRUE)%>%
        ggplot(aes(cluster_interpreted, cortest, fill = cluster_interpreted, 
                   color = cluster_interpreted))+
           geom_bar(aes(linetype = cluster_interpreted), 
                    stat="summary", fun.y = "mean", alpha = .4, width = .5, size = 2)+
    geom_jitter(width = .1, alpha = .1)+
        stat_summary( geom = 'pointrange')+
          stat_summary(aes(group = ssid), geom = 'line', color = "black", alpha = .1)+
    ylab("R pupil vs self report arousal")+
  theme_classic()+
  geom_hline(yintercept = 0, linetype = 'dashed', alpha = .2)+
   # ggpubr::stat_compare_means(paired = TRUE)+
  ggpubr::stat_compare_means(method = 't.test',
                             symnum.args = symnum.args)+
   ylab("R - pupil vs subjective arousal")+
   xlab("Subjective valence")
   
```



<!-- timecourse of pupil based on self reports -->

```{r}
# left_join(tmp.df4_full_stim_downs_jun2021_60bins_no_na, cluster_stim)%>%
# tmp.df4_full_stim_downs_jun2021_60bins %>%


tmp.df4_full_stim_downs_jun2021_60bins_no_na%>%
  ungroup()%>%
  mutate(mediansplit_ground_valence = if_else(ValenceMean >=
                                                  median(ValenceMean,
                                                         na.rm = TRUE), "More positive", "More negative"))%>%
  mutate(mediansplit_ground_arousal = if_else(ArousalMean >=
                                                  median(ArousalMean,
                                                         na.rm = TRUE), "High", "Low"))%>%
    mutate(mediansplit_sample_valence2 = if_else(valence >=
                                                  median(valence,
                                                         na.rm = TRUE), "More positive", "More negative"))%>%
  mutate(mediansplit_sample_arousal2 = if_else(arousal >=
                                                  median(arousal,
                                                         na.rm = TRUE), "High", "Low"))

unique(tmp.df4_full_stim_downs_jun2021_60bins_no_na$ssid)

tmp.df4_full_stim_downs_jun2021_60bins_no_na%>%
  subset(Group == "NT")%>%
  ggplot(aes(x = timerezero3, y = pup_basCor,
             color = mediansplit_sample_arousal2, 
             linetype = mediansplit_sample_valence2))+
  geom_smooth()+
  # stat_smooth(size=1.5, method = "loess", level = 0.95, 
  #   fullrange = TRUE) + 
  # stat_smooth(aes(group=mediansplit_ground_arousal, color = mediansplit_ground_arousal), size = 3)+  
theme_classic()+
  ylab("Pupil size (z)")+
  xlab("Time (s)")+
  # p$graphstyle+
  scale_color_brewer(palette = "Dark2")+
  xlim(0,6)
   # labs(color  = "mediansplit_ground_arousal", linetype = "mediansplit_ground_valence")


tmp.df4_full_stim_downs_jun2021_60bins_no_na<- tmp.df4_full_stim_downs_jun2021_60bins_no_na%>%
group_by(ssid) %>%
  mutate(pp_arousal_outler = if_else(arousal > (median(arousal, na.rm = TRUE) + 
                                               (4*mad(arousal, na.rm = TRUE))), TRUE,
         if_else(arousal < (median(arousal, na.rm = TRUE) - 
                              (4*mad(arousal, na.rm = TRUE))), TRUE, FALSE)))%>%
   mutate(pupil_outlier = if_else(pup_basCor > (median(pup_basCor, na.rm = TRUE) 
                                                + (3*mad(pup_basCor, na.rm = TRUE))), TRUE,
         if_else(pup_basCor < (median(pup_basCor, na.rm = TRUE) - 
                                 (3*mad(pup_basCor, na.rm = TRUE))), TRUE, FALSE)))

unique(tmp.df4_full_stim_downs_jun2021_60bins_no_na$mediansplit_sample_arousal2)

table(is.na(tmp.df4_full_stim_downs_jun2021_60bins_no_na$mediansplit_sample_arousal2))

table(is.na(tmp.df4_full_stim_downs_jun2021_60bins_no_na$mediansplit_sample_valence2))


tmp.df4_full_stim_downs_jun2021_60bins_no_na$Arpisal_newlab<- if_else(tmp.df4_full_stim_downs_jun2021_60bins_no_na$mediansplit_sample_arousal2 == "High", "Agitated", "Calm")

tmp.df4_full_stim_downs_jun2021_60bins_no_na$newlab<- paste0(tmp.df4_full_stim_downs_jun2021_60bins_no_na$Arpisal_newlab, paste0(tmp.df4_full_stim_downs_jun2021_60bins_no_na$mediansplit_sample_valence2))

unique(tmp.df4_full_stim_downs_jun2021_60bins_no_na$newlab)
plots_paper$pupil_course<- tmp.df4_full_stim_downs_jun2021_60bins_no_na %>%
  subset(is.na(mediansplit_sample_arousal2) == FALSE)%>%
  subset(Group == "NT")%>%
  subset(pp_arousal_outler == FALSE)%>%
  subset(pupil_outlier == FALSE)%>%
  
  ggplot(aes(x = timerezero3, y = pup_basCor, color = newlab, linetype = newlab)) +
  # aes(group = ssid),
  geom_smooth()+
  # stat_smooth(size=1.5, method = "loess", level = 0.95, 
  #   fullrange = TRUE) + 
  # stat_smooth(aes(group=mediansplit_ground_arousal, color = mediansplit_ground_arousal), size = 3)+  
# theme_classic()+
  ylab("Pupil size (z)")+
  xlab("Time (s)")+
  p$graphstyle+
   scale_color_brewer(palette = "Dark2")+
  xlim(0,6)+
   labs(color  = "Subjective valence", linetype = "Subjective arousal")
  
# newlab
plots_paper$pupil_course<- plots_paper$pupil_course+
    guides(color=guide_legend(nrow=2, byrow=TRUE))
  
plots_paper$pupil_course
#   
#   tmp.df4_full_stim_downs_jun2021_60bins_no_na %>%
#   subset(is.na(mediansplit_sample_arousal2) == FALSE)%>%
#   subset(Group == "NT")%>%
#   subset(pp_arousal_outler == FALSE)%>%
#   subset(pupil_outlier == FALSE)%>%
#   
#   ggplot(aes(x = timerezero3, y = pup_basCor, color = mediansplit_ground_arousal, linetype = mediansplit_ground_valence)) +
#   # aes(group = ssid),
#   geom_smooth(se = F)+
#   # stat_smooth(size=1.5, method = "loess", level = 0.95, 
#   #   fullrange = TRUE) + 
#   # stat_smooth(aes(group=mediansplit_ground_arousal, color = mediansplit_ground_arousal), size = 3)+  
# # theme_classic()+
#   ylab("Pupil size (z)")+
#   xlab("Time (s)")+
#   # p$graphstyle+
#   # scale_color_brewer(palette = "Dark2")+
#   xlim(0,6)
#   facet_grid(mediansplit_sample_arousal2~mediansplit_)
#    
#   
#   
#     tmp.df4_full_stim_downs_jun2021_60bins_no_na %>%
#   subset(is.na(mediansplit_sample_arousal2) == FALSE)%>%
#   subset(Group == "NT")%>%
#   subset(pp_arousal_outler == FALSE)%>%
#   subset(pupil_outlier == FALSE)%>%
#   
#   ggplot(aes(x = timerezero3, y = pup_basCor, color = mediansplit_sample_arousal2, linetype = mediansplit_ground_valence)) +
#   # aes(group = ssid),
#   geom_smooth(se = F)+
#   # stat_smooth(size=1.5, method = "loess", level = 0.95, 
#   #   fullrange = TRUE) + 
#   # stat_smooth(aes(group=mediansplit_ground_arousal, color = mediansplit_ground_arousal), size = 3)+  
# # theme_classic()+
#   ylab("Pupil size (z)")+
#   xlab("Time (s)")+
#   # p$graphstyle+
#   # scale_color_brewer(palette = "Dark2")+
#   xlim(0,6)
#   facet_grid(mediansplit_sample_arousal2~mediansplit_)
   
```



timecourse stats plots
```{r}
require(RColorBrewer) # make color friendly plots
require(tidyverse)

brewer.pal(4, "Dark2") # gives the exact names of pallets
  # "#1B9E77" "#D95F02" "#7570B3" "#E7298A"
  # timecourse_60bin_result_df$
  # Estimate_ar, Estimate_ar_vl,Estimate_br. Estimate_v
  
plots_timecourse <- list()

#  let's use the order arousal, valence, arousal x valence brightness
View(timecourse_60bin_result_df)

plots_timecourse$eff_size_pup_amp <-   timecourse_60bin_result_df[1:56,] %>% 
  select("timebins","Estimate_ar", "Estimate_vl", "Estimate_br", "Estimate_ar_vl") %>% 
  pivot_longer(-timebins, names_to = "variable", values_to = "Estimate")%>%
    subset(!is.na(Estimate))%>%
  #change the order of the coloring variable here and the name of legends
  mutate(variable = factor(variable, c("Estimate_ar", "Estimate_vl","Estimate_ar_vl",  "Estimate_br"), labels = c("arousal", "valence", "arousal x valence", "brightness")))%>%
  ggplot(aes(timebins, Estimate, group = variable, color= variable))+
  geom_line(aes(linetype = variable), size = 1)+
  
  scale_color_brewer(palette = "Dark2")+
    # scale_color_manual(values=c("#1B9E77", "#D95F02", "#7570B3", "#E7298A"))+
  # use hom correction for significance
  
    # brighteness
    # timecourse_60bin_result_df$timebins[timecourse_60bin_result_df$p_br_adj_TRUE == TRUE]
  
    annotate(geom = 'rect', # use annotate instead of geom_rect, as it is more flexible
             xmin = .16, # got these values from the data-frame. need to fidn a way to automate this
                xmax = 6,
                ymin = -2.03+(sf*.3), # if I ever need to change this, use the scaling factor sf
                ymax = -2+.1+.01+(sf*.3),
                fill =  "#E7298A" , alpha = .5)+ 
    
      annotate("text", 
                x = (1+5.4)/2,
                y = ((-2) +(-2+.1))/2+(sf*.3),
                label = "brightness") +
    
    # arousal
  
    # timecourse_60bin_result_df$p_ar_adj
    # timecourse_60bin_result_df$timebins[timecourse_60bin_result_df$p_ar_adj_TRUE == TRUE]
     annotate(geom = 'rect', xmin = 1,
                xmax = 6,
                ymin = -2.03+.1+.1+.1+.1+(sf*.3),
                ymax = -2+.1+.1+.1+.1+.1+.01+(sf*.3),
                fill = "#1B9E77", alpha = .5)+
        annotate("text", 
                  x = (1+5.4)/2,
                y = ((-2+.1+.1+.1+.1) +(-2+.1+.1+.1+.1+.1))/2+(sf*.3),
                 label = "arousal") +

    # arousal-valence
   # timecourse_60bin_result_df$p_ar_vl_adj
    # timecourse_60bin_result_df$timebins[timecourse_60bin_result_df$p_ar_vl_adj_TRUE == TRUE]
       annotate(geom = 'rect', 
                xmin = 1,
                xmax = 3.30,
                ymin = -2.03+.1+.1+(sf*.3),
                ymax = -2+.1+.1+.1+.01+(sf*.3),
                
                fill ="#7570B3", alpha = .5, label = "text")+
    annotate("text", 
                x = (1+3.30)/2,
                y = ((-2+.1+.1) +(-2+.1+.1+.1))/2+(sf*.3),
                label = "arousal x valence") +
        xlab("Time (s)")+
    ylab("Effect size")+
    xlab("Time (s)")+
    ylab("Effect size")+
  xlim(0,6)

plots_timecourse$eff_size_pup_amp 
# need to rename the label legends


# Edit legend title and labels
plots_timecourse$eff_size_pup_amp <- plots_timecourse$eff_size_pup_amp + 
  p$graphstyle +
    guides(colour = guide_legend(override.aes = list(size=2)))+ #the line size of the legend tends to be smaller in print
  scale_x_continuous(limits = c(0,6), breaks = c(0,2,4,6))+
  scale_y_continuous(limits = c(-2,.7), breaks = c(-1, -0.5, 0,0.5))
  


plots_timecourse$eff_size_pup_amp<- plots_timecourse$eff_size_pup_amp+
  guides(color=guide_legend(nrow=2,byrow=TRUE))
# plots_timecourse$eff_size_pup_velocity
plots_timecourse$eff_size_pup_amp
```
SCR and heart rate
```{r}
plots_paper$interaction_SCR<-
  
interactions::interact_plot(pupil_arousal_findings$BIO_CDA.PhasicMax, pred = arousal_c, modx = valence_c,line.thickness = 2)

plots_paper$interaction_SCR

plots_paper$interaction_SCR <- plots_paper$interaction_SCR +   scale_y_continuous(breaks = c(.4,.45, .5, .55), limits = c(.4,.58))


plots_paper$interaction_SCR


plots_paper$interaction_SCR<- plots_paper$interaction_SCR +
# plots_paper$interaction_ar_vl +
  theme_classic()+
  p$graphstyle_int+
  xlab("Subjective arousal (z)")+
  ylab("Phasic SCR (log)")
  
# scale_y_continuous(breaks = c(-1,0,1))

  plots_paper$interaction_SCR+
    

```



```{r}
  install.packages("expression")

plots_paper$bio_HR <- 
db_full6new_hr_fix_stim_nt1.11%>%
    subset(Bio_Mean_HR_dif_outl!= "outlier")%>%
    group_by(stimIAPS)%>%
    mutate(mean_hr_dif = mean(Bio_Mean_HR_dif, na.rm = TRUE))%>%
    ggplot(aes(valence_c, mean_hr_dif))+
    # geom_point()+
    geom_smooth(method = 'lm', se = F)+
    stat_summary(aes(y = Bio_Mean_HR_dif),geom = 'pointrange')+
  
  xlab("Subjective valence (z)")+
  ylab(expression(Delta*" heart rate (bpm)"))+
    p$graphstyle
  # ggpubr::stat_cor(label.y = -1)

plots_paper$bio_HR
  # scale_y_continuous(breaks = c(-4,-3,-2,1))
  

```



pacthwork

```{r}
library(patchwork)

plot_patch1<- (plots_paper$interaction_ar_vl +
plots_paper$pupil_correlation +
plots_paper$pupil_course +
plots_timecourse$eff_size_pup_amp+
  plots_paper$interaction_SCR+
  plots_paper$bio_HR)+
  plot_layout(nrow = 3)+
  plot_annotation(tag_levels = "A")
  
plot_patch1

ggsave("patch_plot1.png", plot_patch1, device = "png", width = 15,height = 15, dpi = 800)
ggsave("patch_plot1.tiff", plot_patch1, device = "tiff", width = 15,height = 15, dpi = 800)
```


```{r}

p$graphstyle_tsne <-  theme(#base plot theme
  
  # axis lines
  # axis.line.y = element_line(color="black", size = 1.5),
  # axis.line.x = element_line(color="black", size = 1,5),
  
  axis.title.y=element_text(size = 16*(sf+.5), margin=margin(0,5,0,0)),
  axis.title.x=element_text(size = 16*(sf+.5), margin=margin(0,5,0,0)),
  
  # text
  strip.text.x = element_text(size = 12*(sf+.5),  colour = "black"),
  strip.text.y = element_text(size = 12*(sf+.5),  colour = "black"),
  
  text=element_text(size = 14, family = "sans"),
  axis.text.x = element_text(size = 14*(sf+.5), family = "sans", colour = "black",),
  axis.text.y = element_text(size = 14*(sf+.5), family = "sans", colour = "black"),
  
  
  # panel
  panel.grid.major = element_blank(),
   panel.border = element_rect(colour = "black", fill=NA, size=5),
  panel.background = element_blank(),
  # panel.background = element_rect(fill="transparent"),
  # panel.border = element_rect(fill="black"),
  # strip shades (reco rectagles)
   # strip.background = element_blank(),
  
  # legend
  legend.position = "top",
  legend.key = element_rect(colour = "transparent", fill="transparent"),
  #legend.direction = "horizontal",

  legend.text = element_text(size = 10*(sf+.3)),
  # legend.title = element_text(size = 10*(sf+.3)),
  # legend line tends to be really small in print so adjust here
  legend.key.height = unit(.5, "cm"),
  legend.key.width = unit(2, "cm"),
  
  #legend.text = element_text(size = 10*sf),
  # legend.title=element_blank(),
  #legend.text = element_blank(),
  #axis.ticks = element_blank(),
)
?stat_ellipse


clustering_agg
clustering_agg$cluster_interpreted<- NULL
clustering_agg$AlexGroup<-NULL
clustering_agg$y_kmeans<-NULL

clustering_agg_JASPtest$stimIAPS2<- as.character(clustering_agg_JASPtest$stimIAPS2)
clust_stim2<- select(clustering_agg_JASPtest, c(stimIAPS2,clusters, stimDescription))

test<- left_join(clustering_agg,clust_stim2)

colnames(clustering_agg_JASPtest)
clustering_agg_JASPtest<- subset(clustering_agg_JASPtest, !is.na(clustering_agg_JASPtest$clusters))
pca_res <- prcomp(clustering_agg_JASPtest[,c(24,23,19)], center = TRUE, scale. = TRUE)
plot_data <- cbind(as.data.frame(pca_res$x[, 1:2]), labels = clustering_agg_JASPtest$clusters)
plot_data$labels<- factor(plot_data$labels)
# stat_el
# plot_data$
plots_paper$PCA_clust 


plot_data%>%
  subset(!is.na(labels))%>%
   # subset(!is.na(cluster))%>%
  ggplot( aes(x = PC1, y = PC2, colour = labels)) +
  geom_point(size = 1, alpha = .8)+
  # geom_text(aes(label= test$stimDescription), alpha = .7, size = 5)+
  stat_ellipse()+
  # stat_ellipse(aes(x = PC1,y=PC2,
  #                  lty=labels,
  #                  fill=labels,
  #                  color=labels),
  #   geom="polygon",
  #   alpha=0.2,
  #   size = 1.5)+
  # scale_fill_manual(values=c("red","green","blue"))+
    # scale_color_manual(values=c("red","green","blue"))+
  # scale_linetype_manual(values=c(1,2,3))+
  ylab("Componet 2")+
  xlab("Component 1")+
  p$graphstyle +
  
theme(
  # axis.text.y   = element_text(size=14),
        # axis.text.x   = element_text(size=14),
        # axis.title.y  = element_text(size=14),
        # axis.title.x  = element_text(size=14),
        panel.background = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        axis.line = element_line(colour = "black"),
        panel.border = element_rect(colour = "black", fill=NA, size=3)
  )

plots_paper$PCA_clust
ggsave("PCA_clust.tiff", plots_paper$PCA_clust , device = "tiff", width = 10, height = 7, dpi = 800)

```

```{r}

clust_stim2
clustering_new <- left_join(clustering, clust_stim2, by = c("stimIAPS2", "stimDescription"))

clustering_new$Cluster<- clustering_new$clusters

library(ggpubr)
unique(tmp.df4_full_stim_downs_jun2021_60bins_no_na1$ssid)
plots_paper$arousal_clust<- clustering_new %>%
  subset(!is.na(Cluster))%>%
  # subset(ssid_num>303)%>%^
  group_by(ssid, Cluster)%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  # mutate(arousal2 = abs(arousal))%>%
  subset(arousal> -9)%>%
  ggboxplot(x = "Cluster", y = "arousal",
          color = "Cluster")+
  geom_jitter(width = .1, alpha = .2)+
    stat_summary(aes(group =ssid), geom =  'line', alpha = .2, size = .1)+
  xlab("Cluster")+
  ylab("Subjective arousal \n (calm - agitated)")+
  p$graphstyle+ theme(legend.position = "none")+
  scale_y_continuous(breaks = c(-6, -4, 0, 4))
  # stat_compare_means(comparisons = my_comparisons)+ # Add pairwise comparisons p-value
  # stat_compare_means(label.y = 9)
plots_paper$arousal_clust
# valence cluster

plots_paper$valence_clust<- clustering_new %>%
  subset(!is.na(Cluster))%>%
  group_by(ssid, Cluster)%>%
  
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  mutate(arousal2 = abs(arousal))%>%
  subset(arousal> -9)%>%
  ggboxplot(x = "Cluster", y = "valence",
          color = "Cluster")+
  geom_jitter(width = .1, alpha = .2)+
    stat_summary(aes(group =ssid), geom =  'line', alpha = .2, size = .1)+
  xlab("Cluster")+
  ylab("Subjective valence \n (negative - positive)")+
  p$graphstyle+ theme(legend.position = "none")
  # stat_compare_means(comparisons = my_comparisons)+ # Add pairwise comparisons p-value
  # stat_compare_means(label.y = 9)

plots_paper$valence_clust

clust_subjective<- plots_paper$valence_clust+plots_paper$arousal_clust+
  plot_layout(ncol = 2)+plot_annotation(tag_levels = "A")


clust_subjective

ggsave("clust_subjective.tiff", clust_subjective, device = "tiff", width = 10, height = 5, dpi = 800)
```



```{r}
tsne::tsne()

```

Phasic responses reveal limited cross correlations across physiological signals
```{r}

correlation_plot<- db_full6new_hr_fix_stim_nt1.1 %>%
  mutate(log_BIO_CDA.PhasicMax = log1p(BIO_CDA.PhasicMax+.1))%>%
  subset(ssid!= "347")%>%
  subset(!is.na(mediansplit_ground_valence))%>%
  subset(Bio_Mean_HR_dif_outl!= "outlier")%>%
  group_by(ssid)%>%
  mutate(Bio_Mean_HR_dif = scale(Bio_Mean_HR_dif, center = TRUE, scale = TRUE)[,1],
         pup_basCor = scale(pup_basCor, center = TRUE, scale = TRUE)[,1],
         log_BIO_CDA.PhasicMax = scale(log_BIO_CDA.PhasicMax, center = TRUE, scale = TRUE)[,1])%>%
  group_by(ssid, mediansplit_ground_valence)%>%
  mutate(cor_hr_pup = cor(Bio_Mean_HR_dif, pup_basCor, use = "complete"))%>%
  mutate(cor_hr_scr = cor(Bio_Mean_HR_dif, log_BIO_CDA.PhasicMax, use = "complete"))%>%
  mutate(cor_pup_scr = cor(pup_basCor, log_BIO_CDA.PhasicMax, use = "complete"))%>%
  select(c(ssid, mediansplit_ground_valence,cor_hr_pup, cor_hr_scr, cor_pup_scr))%>%
  gather(key, value, -ssid,-mediansplit_ground_valence)%>%
  group_by(ssid,mediansplit_ground_valence, key, value)%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  ggplot(aes(key, value, color = key))+
  geom_hline(yintercept = 0, size = 1.5, linetype = "dashed", alpha = .5)+
  geom_line(aes(group = ssid), se = F, color = "black", alpha = .2)+
  geom_jitter(width = .1, alpha = .5)+
  
  stat_summary(geom = 'pointrange', color = "black")+
    facet_grid(~mediansplit_ground_valence)+
  
  p$graphstyle+
  ylab("Correlation")+
  scale_x_discrete(
        labels=c("HR vs. Pupil", "HR vs. SCR", "Pupil vs. SCR"))+
  theme(axis.title.x = element_blank(), axis.text.x = element_text( 
                           size=14, angle=45), legend.position = "none")+
  scale_color_brewer(palette = "Dark2")
  # ggpubr::ggviolin(aes(x = "key", y = "value"))
  
  # subset(db_full6new_hr_fix_stim_nt1.1, Bio_Mean_HR_dif )
  
  correlation_plot
  
  db_full6new_hr_fix_stim_nt1.1
  
  ?cut
  db_full6new_hr_fix_stim_nt1.1$valeence_groun_3cat<- cut(db_full6new_hr_fix_stim_nt1.1$ValenceMean, breaks = 3, labels = c("negative", "mid", "positive"))
  
  db_full6new_hr_fix_stim_nt1.1 %>%
  mutate(log_BIO_CDA.PhasicMax = log1p(BIO_CDA.PhasicMax+.1))%>%
  subset(ssid!= "347")%>%
  subset(Bio_Mean_HR_dif_outl!= "outlier")%>%
    subset(!is.na(valeence_groun_3cat))%>%
  group_by(ssid)%>%
  mutate(Bio_Mean_HR_dif = scale(Bio_Mean_HR_dif, center = TRUE, scale = TRUE)[,1],
         pup_basCor = scale(pup_basCor, center = TRUE, scale = TRUE)[,1],
         log_BIO_CDA.PhasicMax = scale(log_BIO_CDA.PhasicMax, center = TRUE, scale = TRUE)[,1])%>%
    group_by(ssid, valeence_groun_3cat)%>%
  mutate(cor_hr_pup = cor(Bio_Mean_HR_dif, pup_basCor, use = "complete"))%>%
  mutate(cor_hr_scr = cor(Bio_Mean_HR_dif, log_BIO_CDA.PhasicMax, use = "complete"))%>%
  mutate(cor_pup_scr = cor(pup_basCor, log_BIO_CDA.PhasicMax, use = "complete"))%>%
  select(c(ssid,valeence_groun_3cat, cor_hr_pup, cor_hr_scr, cor_pup_scr))%>%
  gather(key, value, -ssid, - valeence_groun_3cat)%>%
  group_by(ssid, key, value, valeence_groun_3cat)%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  ggplot(aes(valeence_groun_3cat, value, color = valeence_groun_3cat))+
  geom_hline(yintercept = 0, size = 1.5, linetype = "dashed", alpha = .5)+
    geom_hline(yintercept = .2, size = 1.5, linetype = "dashed", alpha = .5)+
    geom_hline(yintercept = -.2, size = 1.5, linetype = "dashed", alpha = .5)+
  geom_line(aes(group = ssid), se = F, color = "black", alpha = .2)+
  geom_jitter(width = .1, alpha = .5)+
  
  stat_summary(geom = 'pointrange', color = "black")+
    facet_grid(~key)+
  
  p$graphstyle+
  ylab("Correlation")+
  scale_x_discrete(
        labels=c("HR vs. Pupil", "HR vs. SCR", "Pupil vs. SCR"))+
  theme(axis.title.x = element_blank(), axis.text.x = element_text( 
                           size=14, angle=45))+
  scale_color_brewer(palette = "Dark2")
  
  
```
  


```{r}
ggsav

 hr_rmmcorr<- db_full6new_hr_fix_stim_nt1.1 %>%
  # mutate(log_BIO_CDA.PhasicMax = log1p(BIO_CDA.PhasicMax+.1))%>%
  subset(ssid!= "347")%>%
  subset(Bio_Mean_HR_dif_outl!= "outlier")
plot(rmcorr::rmcorr(participant = "ssid", measure1 = "Bio_Mean_HR_dif", measure2 = "pup_basCor", data = hr_rmmcorr))


plot(rmcorr::rmcorr(participant = "ssid", measure1 = "log_BIO_CDA.PhasicMax_z", measure2 = "pup_basCor", data = hr_rmmcorr))


hr_rmmcorr<- hr_rmmcorr%>%
  group_by(ssid)%>%
  mutate(log_BIO_CDA.PhasicMax_z= scale(log_BIO_CDA.PhasicMax, center =TRUE, scale = TRUE))
  
plot(rmcorr::rmcorr(participant = "ssid", measure1 = "log_BIO_CDA.PhasicMax_z", measure2 = "Bio_Mean_HR_dif", data = hr_rmmcorr))

correlation_plot

scater_pupil_HR<- db_full6new_hr_fix_stim_nt1.1 %>%
  subset(!is.na(stimDescription))%>%
  subset(!is.na(mediansplit_ground_valence))%>%
  group_by(stimIAPS,mediansplit_ground_valence, stimDescription)%>%
  subset(Bio_Mean_HR_dif_outl!= "outlier")%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  ggplot(aes(Bio_Mean_HR_dif, pup_basCor))+
  geom_point(aes(color = mediansplit_ground_valence), size = 2, alpha = .6)+
  geom_text(aes(label = stimDescription,olor = mediansplit_ground_valence), alpha = .3)+
  geom_smooth(method = 'lm', se = F)+
  ggpubr::stat_cor()+
  xlab(expression("Average "*Delta*" heart rate (bpm)"))+
  # xlab("Average heart rate difference")+
  ylab("Average pupil change (au)")+
  p$graphstyle

scater_pupil_HR

db_full6new_hr_fix_stim_nt1.1 %>%
  subset(!is.na(stimDescription))%>%
  subset(!is.na(mediansplit_ground_valence))%>%
  group_by(stimIAPS, stimDescription,mediansplit_ground_valence)%>%
  subset(Bio_Mean_HR_dif_outl!= "outlier")%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  ggplot(aes(Bio_Mean_HR_dif, pup_basCor, color = mediansplit_ground_valence))+
  geom_point(size = 2, alpha = .6)+
  geom_text(aes(label = stimDescription), alpha = .3)+
  geom_smooth(method = 'lm', se = F)+
  ggpubr::stat_cor()+
  xlab(expression("Average "*Delta*" heart rate (bpm)"))+
  # facet_grid(~mediansplit_ground_valence)+
  # xlab("Average heart rate difference")+
  ylab("Average pupil change (au)")+
  p$graphstyle


db_full6new_hr_fix_stim_nt1.1$log_BIO_CDA.PhasicMax_z<- scale(db_full6new_hr_fix_stim_nt1.1$log_BIO_CDA.PhasicMax, center =  TRUE,scale = TRUE)[,1]

db_full6new_hr_fix_stim_nt1.1 %>%
  subset(!is.na(stimDescription))%>%
  subset(!is.na(mediansplit_ground_valence))%>%
  group_by(stimIAPS, stimDescription,mediansplit_ground_valence)%>%
  subset(Bio_Mean_HR_dif_outl!= "outlier")%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  ggplot(aes(Bio_Mean_HR_dif, log_BIO_CDA.PhasicMax_z, color = mediansplit_ground_valence))+
  geom_point(size = 2, alpha = .6)+
  geom_text(aes(label = stimDescription), alpha = .3)+
  geom_smooth(method = 'lm', se = F)+
  ggpubr::stat_cor()+
  xlab(expression("Average "*Delta*" heart rate (bpm)"))+
  # facet_grid(~mediansplit_ground_valence)+
  # xlab("Average heart rate difference")+
  ylab("Average pupil change (au)")+
  p$graphstyle


db_full6new_hr_fix_stim_nt1.1$stimIAPS2<- as.factor(substr(db_full6new_hr_fix_stim_nt1.1$stimIAPS, 1,4))


macthed_test$matched<- "matched"

macthed_test$stimIAPS2<- as.factor(macthed_test$stimIAPS2)

# mac
testmatched_hr_stim<- left_join(macthed_test,db_full6new_hr_fix_stim_nt1.1,  by = c("stimIAPS2"))

testmatched_hr_stim %>%
  subset(!is.na(mediansplit_ground_valence))%>%
  subset(!is.na(matched))%>%
  group_by(stimIAPS, stimDescription,mediansplit_ground_valence)%>%
  subset(Bio_Mean_HR_dif_outl!= "outlier")%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  ungroup()%>%
  mutate(log_BIO_CDA.PhasicMax_z = scale(log_BIO_CDA.PhasicMax), pup_basCor_z = scale(pup_basCor))%>%
  ggplot(aes(Bio_Mean_HR_dif, pup_basCor, color = mediansplit_ground_valence))+
  geom_point(size = 2, alpha = .6)+
  geom_text(aes(label = stimDescription), alpha = .3)+
  geom_smooth(method = 'lm', se = F)+
  ggpubr::stat_cor()+
  xlab(expression("Average "*Delta*" heart rate (bpm)"))+
  # facet_grid(~mediansplit_ground_valence)+
  # xlab("Average heart rate difference")+
  ylab("Average pupil change (au)")+
  p$graphstyle



testmatched_hr_stim %>%
  subset(!is.na(mediansplit_ground_valence))%>%
  subset(!is.na(matched))%>%
  group_by(stimIAPS, stimDescription,mediansplit_ground_valence)%>%
  subset(Bio_Mean_HR_dif_outl!= "outlier")%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  ungroup()%>%
  mutate(log_BIO_CDA.PhasicMax_z = scale(log_BIO_CDA.PhasicMax), pup_basCor_z = scale(pup_basCor))%>%
  ggplot(aes(Bio_Mean_HR_dif, log_BIO_CDA.PhasicMax_z, color = mediansplit_ground_valence))+
  geom_point(size = 2, alpha = .6)+
  geom_text(aes(label = stimDescription), alpha = .3)+
  geom_smooth(method = 'lm', se = F)+
  ggpubr::stat_cor()+
  xlab(expression("Average "*Delta*" heart rate (bpm)"))+
  # facet_grid(~mediansplit_ground_valence)+
  # xlab("Average heart rate difference")+
  ylab("Average pupil change (au)")+
  p$graphstyle


testmatched_hr_stim %>%
  subset(!is.na(mediansplit_ground_valence))%>%
  subset(!is.na(matched))%>%
  group_by(stimIAPS, stimDescription,mediansplit_ground_valence)%>%
  subset(Bio_Mean_HR_dif_outl!= "outlier")%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  ungroup()%>%
  mutate(log_BIO_CDA.PhasicMax_z = scale(log_BIO_CDA.PhasicMax), pup_basCor_z = scale(pup_basCor))%>%
  ggplot(aes(pup_basCor_z, log_BIO_CDA.PhasicMax_z, color = mediansplit_ground_valence))+
  geom_point(size = 2, alpha = .6)+
  geom_text(aes(label = stimDescription), alpha = .3)+
  geom_smooth(method = 'lm', se = F)+
  ggpubr::stat_cor()+
  xlab(expression("Average "*Delta*" heart rate (bpm)"))+
  # facet_grid(~mediansplit_ground_valence)+
  # xlab("Average heart rate difference")+
  ylab("Average pupil change (au)")+
  p$graphstyle


library(patchwork)
patch_correlations <- correlation_plot+scater_pupil_HR+
   plot_layout(ncol = 2)+plot_annotation(tag_levels = "A")
patch_correlations
ggsave("patch_correlations.tiff", patch_correlations, device = "tiff", width = 12, height = 5, dpi = 800)
```

supplemental

unique(db_full4new_stim_screen_pupil_nopract$ssid)

```{r}

fix_dur_byval<-
db_full4new_stim_screen_pupil_nopract %>%
  subset(pp_arousal_outler== FALSE)%>%
  subset(Group == "NT")%>%
  subset(pupil_outlier == FALSE)%>%
  subset(!is.na(Alexithymia))%>%
  # group_by(mediansplit_ground_valence)%>%
  # mutate(pup_basCor_mean = mean(pup_basCor, na.rm = TRUE), sd_pup = sd(pup_basCor, na.rm = TRUE), subj = n())%>%
  group_by(ssid, mediansplit_ground_valence)%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  # group_by(mediansplit_ground_valence)%>%
  # mutate(pup_basCor_se = sd_pup/(sqrt(subj)))%>%
  ggplot(aes(mediansplit_ground_valence, mean_fix_dur))+
  # geom_bar(stat="summary", fun.y = "mean", alpha = .4, color = FALSE)+
      geom_jitter(width = .1, alpha=.2)+
  stat_summary(geom = 'pointrange',  size = 1, colour = "Black") +
  # geom_errorbar(aes(ymin = pup_basCor_mean-pup_basCor_se, ymax = pup_basCor_mean+pup_basCor_se ))+
  geom_line(aes(group = ssid), alpha = .1)+
  p$graphstyle+
  theme(axis.text.x = element_text(size = 14, angle = 45), axis.title.x = element_blank())+
  xlab("Valence")+
  ylab("Average fixation duration (ms)")+
  # ylab("Baseline corrected pupil")+

  scale_color_brewer(palette = "Dark2")+
   scale_fill_brewer(palette = "Dark2")+
  ggpubr::stat_compare_means(method = "t.test", paired =  TRUE)
  # facet_grid(~mediansplit_ground_valence)+
  # ylim(-3.3,1.3)

? ggpubr::stat_compare_means
fix_dur_byval

fix_dur_byval<-
db_full4new_stim_screen_pupil_nopract %>%
  subset(pp_arousal_outler== FALSE)%>%
  subset(Group == "NT")%>%
  subset(pupil_outlier == FALSE)%>%
  subset(!is.na(Alexithymia))%>%
  # group_by(mediansplit_ground_valence)%>%
  # mutate(pup_basCor_mean = mean(pup_basCor, na.rm = TRUE), sd_pup = sd(pup_basCor, na.rm = TRUE), subj = n())%>%
  group_by(ssid, mediansplit_ground_valence)%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  # group_by(mediansplit_ground_valence)%>%
  # mutate(pup_basCor_se = sd_pup/(sqrt(subj)))%>%
  ggplot(aes(mediansplit_ground_valence, mean_fix_dur))+
  # geom_bar(stat="summary", fun.y = "mean", alpha = .4, color = FALSE)+
      geom_jitter(width = .1, alpha=.2)+
  stat_summary(geom = 'pointrange', alpha = .1, size = 1, colour = "Black") +
  # geom_errorbar(aes(ymin = pup_basCor_mean-pup_basCor_se, ymax = pup_basCor_mean+pup_basCor_se ))+
  geom_line(aes(group = ssid), alpha = .1)+
  p$graphstyle+
  theme(axis.text.x = element_text(size = 14, angle = 45), axis.title.x = element_blank())+
  xlab("Valence")+
  ylab("Average fixation duration (ms)")+
  # ylab("Baseline corrected pupil")+

  scale_color_brewer(palette = "Dark2")+
   scale_fill_brewer(palette = "Dark2")+
  ggpubr::stat_compare_means(method = "t.test", paired =  TRUE)
  # facet_grid(~mediansplit_ground_valence)+


fix_dur_count<- db_full4new_stim_screen_pupil_nopract %>%
  subset(pp_arousal_outler== FALSE)%>%
  subset(Group == "NT")%>%
  subset(pupil_outlier == FALSE)%>%
  subset(!is.na(Alexithymia))%>%
  # group_by(mediansplit_ground_valence)%>%
  # mutate(pup_basCor_mean = mean(pup_basCor, na.rm = TRUE), sd_pup = sd(pup_basCor, na.rm = TRUE), subj = n())%>%
  group_by(ssid, mediansplit_ground_valence)%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  # group_by(mediansplit_ground_valence)%>%
  # mutate(pup_basCor_se = sd_pup/(sqrt(subj)))%>%
  ggplot(aes(mediansplit_ground_valence, fix_count))+
  # geom_bar(stat="summary", fun.y = "mean", alpha = .4, color = FALSE)+
      geom_jitter(width = .1, alpha=.2)+
  stat_summary(geom = 'pointrange', size = 1, colour = "Black") +
  # geom_errorbar(aes(ymin = pup_basCor_mean-pup_basCor_se, ymax = pup_basCor_mean+pup_basCor_se ))+
  geom_line(aes(group = ssid), alpha = .1)+
  p$graphstyle+
    theme(axis.text.x = element_text(size = 14, angle = 45), axis.title.x = element_blank())+
  xlab("Valence")+
  ylab("Average fixation count")+
  # ylab("Baseline corrected pupil")+

  scale_color_brewer(palette = "Dark2")+
   scale_fill_brewer(palette = "Dark2")+
  ggpubr::stat_compare_means(method = "t.test", paired =  TRUE)


# data loss
loss_dur_byval<- db_full4new_stim_screen_pupil_nopract %>%
  subset(pp_arousal_outler== FALSE)%>%
  subset(Group == "NT")%>%
  subset(pupil_outlier == FALSE)%>%
  subset(!is.na(Alexithymia))%>%
  # group_by(mediansplit_ground_valence)%>%
  # mutate(pup_basCor_mean = mean(pup_basCor, na.rm = TRUE), sd_pup = sd(pup_basCor, na.rm = TRUE), subj = n())%>%
  group_by(ssid, mediansplit_ground_valence)%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)%>%
  # group_by(mediansplit_ground_valence)%>%
  # mutate(pup_basCor_se = sd_pup/(sqrt(subj)))%>%
  ggplot(aes(mediansplit_ground_valence, 1-gaze_valid_prop))+
  # geom_bar(stat="summary", fun.y = "mean", alpha = .4, color = FALSE)+
      geom_jitter(width = .1, alpha=.2)+
  stat_summary(geom = 'pointrange', size = 1, colour = "Black") +
  # geom_errorbar(aes(ymin = pup_basCor_mean-pup_basCor_se, ymax = pup_basCor_mean+pup_basCor_se ))+
  geom_line(aes(group = ssid), alpha = .1)+
  p$graphstyle+
  theme(axis.text.x = element_text(size = 14, angle = 45), axis.title.x = element_blank())+
  xlab("Valence")+
  ylab("Average gaze loss (prop)")+
  # ylab("Baseline corrected pupil")+

  scale_color_brewer(palette = "Dark2")+
   scale_fill_brewer(palette = "Dark2")+
  ggpubr::stat_compare_means(method = "t.test", paired =  TRUE)

library(patchwork)
gaze_control <- fix_dur_byval+fix_dur_count+
loss_dur_byval

https://lvdmaaten.github.io/tsne/

ggsave("gaze_control.tiff",gaze_control, device = "tiff", width = 13, height = 6, dpi = 800)
https://www.r-bloggers.com/2017/09/multi-dimensional-reduction-and-visualisation-with-t-sne/
  https://cran.r-project.org/web/packages/Rtsne/Rtsne.pdf
https://uc-r.github.io/kmeans_clustering
https://sciwheel.com/work/item/5365248/resources/12059185/pdf
```



3dplots
```{r}
clustering_agg_JASP
clustering_agg_JASPtest

clustering_agg_noflood$log_Bio_CDA.PhasicMax_z<- scale(clustering_agg_noflood$log_BIO_CDA.PhasicMax)

clustering_agg_noflood$Bio_Mean_HR_dif_z<- scale(clustering_agg_noflood$Bio_Mean_HR_dif)

clustering_agg_noflood$pup_basCor_z<- scale(clustering_agg_noflood$pup_basCor)

clustering_agg_noflood<- subset(clustering_agg, stimDescription != "Flood")
car::scatter3d(clustering_agg_noflood$log_Bio_CDA.PhasicMax_z, 
          clustering_agg_noflood$Bio_Mean_HR_dif_z, 
          clustering_agg_noflood$pup_basCor_z,
          fit = "smooth",
          point = FALSE,
          ellipsoid = TRUE,
          surface = FALSE,
          groups = clustering_agg_noflood$y_kmeans,
          point.col = clustering_agg_noflood$y_kmeans
          )


car::scatter3d(clustering_agg_noflood$log_Bio_CDA.PhasicMax_z, 
          clustering_agg_noflood$Bio_Mean_HR_dif_z, 
          clustering_agg_noflood$pup_basCor_z,
          fit = "smooth",
          point = FALSE,
          # ellipsoid = TRUE,
          surface = FALSE,
          groups = clustering_agg_noflood$y_kmeans,
          point.col = clustering_agg_noflood$y_kmeans
          )


# clustering_agg_JASP$clusters<- as.factor(clustering_agg_JASP$clusters)

clustering_agg_JASPtest$HR<-clustering_agg_JASPtest$Bio_Mean_HR_dif
clustering_agg_JASPtest$SCR<-clustering_agg_JASPtest$log_Bio_CDA.PhasicMax_z
clustering_agg_JASPtest$Pupil<-clustering_agg_JASPtest$pup_basCor_z

SCR<- clustering_agg_JASPtest$SCR
HR<- clustering_agg_JASPtest$HR
Pupil<- clustering_agg_JASPtest$Pupil
Cluster<- clustering_agg_JASPtest$clusters

car::scatter3d(SCR, 
          HR, 
          Pupil,
          # fit = "smooth",
          point = TRUE,
          ellipsoid = TRUE,
          surface = FALSE,
          groups = Cluster,
          point.col = Cluster
          )

car::scatter3d(clustering_agg_JASPtest$log_Bio_CDA.PhasicMax_z, 
          clustering_agg_JASPtest$Bio_Mean_HR_dif, 
          clustering_agg_JASPtest$pup_basCor,
          fit = "smooth",
          point = TRUE,
          # ellipsoid = TRUE,
          # surface = FALSE,
          groups = Cluster,
          point.col = Cluster
          )



car::scatter3d(SCR, 
          HR, 
          Pupil,
          fit = "smooth",
          point = TRUE,
          ellipsoid = TRUE,
          surface = FALSE,
          groups = Cluster,
          point.col = Cluster
          )
?car::scatter3d
car::scatter3d(SCR, 
          HR, 
          Pupil,
          fit = "smooth",
          point = TRUE,
          # ellipsoid = TRUE,
          surface = FALSE,
          groups = Cluster,
          point.col = Cluster
          )
```
